<!DOCTYPE html>
<html>

<head>
    <title>HCR Bot Tutorial : Bot #2 - Flow #2 - Capturing the location</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
    <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/afd53ae465.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</head>

<body>
    <nav class="navbar  navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="index.html">HCR Tutorial</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="Environment-Setup.html">Environment Setup</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="Bot-1-Flow-1.html">Bot 1 - Flow 1</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="Bot-2-Flow-1.html">Bot 2 - Flow 1</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="Bot-2-Flow-2.html">Bot 2 - Flow 2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="Bot-2-Flow-3.html">Bot 2 - Flow 3</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">

        <div></div>
        <div>
            <div class="jumbotron">
                <h1>
                    HCR Bot Tutorial : Bot #2 - Flow #2
                </h1>
                <p class="lead">Capturing the location</p>
            </div>
        </div>
        <div class="row">
            <div class="col-2">
                <ul class="nav nav-pills flex-column" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="step1-tab" data-toggle="tab" href="#step1" role="tab"
                            aria-controls="step 1" aria-selected="true">Step 1</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="step2-tab" data-toggle="tab" href="#step2" role="tab"
                            aria-controls="step 2" aria-selected="false">Step 2</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="step3-tab" data-toggle="tab" href="#step3" role="tab"
                            aria-controls="step 3" aria-selected="false">Step 3</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="step4-tab" data-toggle="tab" href="#step4" role="tab"
                            aria-controls="step 4" aria-selected="false">Step 4</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="step5-tab" data-toggle="tab" href="#step5" role="tab"
                            aria-controls="step 5" aria-selected="false">Step 5</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="step6-tab" data-toggle="tab" href="#step6" role="tab"
                            aria-controls="step 6" aria-selected="false">Step 6</a>
                    </li>
                </ul>
            </div>
            <div class="col-10">
                <div class="tab-content" id="tabbedsteps">
                    <div class="tab-pane fade show active" id="step1" role="tabpanel" aria-labelledby="step1-tab">
                        <h1>Step 1</h1>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Begin by adding a new class, LocationDialog, it should inherit from ComponentDialog. Add:
                            The WaterfallDialog class, with empty waterfall steps.
                            A text prompt,
                            and a ChoicePrompt, with a name of “ClubPrompt”.
                            Also tell it that the InitialDialog is the waterfalldialog.
                        </div>
                        <span class="inline-comment-marker" data-ref="79aa4b97-644f-4888-bd4c-7cae9044300f">
                            You should
                            end up with something that looks like thi
                        </span>s@
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence">      public LocationDialog() 
      : base(nameof(LocationDialog))
      {         
         var waterfallSteps = new WaterfallStep[]
         {
         };
         //Register the waterfall dialog. 
         AddDialog(new WaterfallDialog(nameof(WaterfallDialog), waterfallSteps));
         //Register text prompts, so we can re-use them. 
         AddDialog(new TextPrompt(nameof(TextPrompt)));
         AddDialog(new ChoicePrompt(&quot;ClubPrompt&quot;));
         //Make sure we start with the waterfall dialog
         InitialDialogId = nameof(WaterfallDialog);
      }</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show" id="step2" role="tabpanel" aria-labelledby="step2-tab">
                        <h1>Step 2</h1>
                        Let’s begin with the ChoicePrompt, this is a bit new.This type of prompt will allow us to
                        present
                        a fixed set of options to the user, that they can click on to choose.
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Add out first step - ChooseClubPrompt - and generate the method.
                        </div>
                        Into that method, we’re going to present some choices, a prompt to pick one, and a retry prompt
                        in-case they send back something we don’t understand (e.g. they type a club name we don’t
                        support).
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence">  private async Task&lt;DialogTurnResult&gt; ChooseClubStep(WaterfallStepContext stepContext, CancellationToken cancellationToken)
      {
         return await stepContext.PromptAsync(&quot;ClubPrompt&quot;, new PromptOptions
         {
            Choices = ChoiceFactory.ToChoices(new List&lt;string&gt; { &quot;Vauxhall FC&quot;, &quot;London United&quot; }),
            Prompt = MessageFactory.Text(&quot;What club are you at?&quot;),
            RetryPrompt = MessageFactory.Text(&quot;Please select one of the clubs I know&quot;)
         });
      }</code></pre>
                            </div>
                        </div>
                        To test the dialog, we need to use it from the main HCRDialogBot class.
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            In the constructor, add it to the dialogset, just below the GreetingDialog
                        </div>
                        Now, in OnTurnAsync, we want to kick i<span class="inline-comment-marker"
                            data-ref="5078ab2a-f8ac-4e2b-87b6-886d5d60ebea">t off when the GreetingDialog</span> has
                        finished.
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Add the snippet like this:
                        </div>
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence">else
               {
                  var lastdialog = dc.ActiveDialog.Id;
                  var continueResult = await dc.ContinueDialogAsync(cancellationToken);
                  if (continueResult.Status == DialogTurnStatus.Complete)
                     switch (lastdialog)
                     {
                        case nameof(GreetingDialog):
                           var greetingResult = (GreetingResult)continueResult.Result;
                           await turnContext.SendActivityAsync(MessageFactory.Text($&quot;You have reported a crime of {greetingResult.CrimeType}.&quot;), cancellationToken);
                           await turnContext.SendActivityAsync(MessageFactory.Text(ThankYou), cancellationToken);
                           await dc.BeginDialogAsync(nameof(LocationDialog), null, cancellationToken);
                           break;
                     }                    
               }
</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show" id="step3" role="tabpanel" aria-labelledby="step3-tab">
                        <h1>Step 3</h1>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Add a a new class to capture the results of this dialog.
                        </div>
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence">   public class LocationResult
   {
      public string Club { get; set; }
      public string Stand { get; set; }
      public string Zone { get; set; }
      public string Row { get; set; }
      public int Seat { get; set; }
      public int ReporterSeat { get; set; }
   }</code></pre>
                            </div>
                        </div>
                        <p>Now let’s start capturing that information.</p> <span
                            class="confluence-embedded-file-wrapper image-center-wrapper">
                            <img src="attachments/1031340065/1036222528.png">
                        </span>
                        <p></p>We are going to ask lots of Yes or No questions, and capture a few text answers, and a
                        few
                        numeric answers.
                        To do so we need to add a few more Prompt types.</p>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            In the LocationDialog class constructor, use the AddDialog method to register a new
                            ConfirmPrompt, called “YesNoPrompt”, and a number prompt for a type of integer, called
                            “NumPrompt”.
                        </div>
                        Our constructor should contain the following:
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence"
                                       data-theme="Confluence">         //Register the waterfall dialog. 
         AddDialog(new WaterfallDialog(nameof(WaterfallDialog), waterfallSteps));
         //Register text prompts, so we can re-use them. 
         AddDialog(new TextPrompt(nameof(TextPrompt)));
         //register a choice prompt, so we can ask them to pick from a list
         AddDialog(new ChoicePrompt(&quot;ClubPrompt&quot;));
         //register a confirm prompt, for yes/no questions
         AddDialog(new ConfirmPrompt(&quot;YesNoPrompt&quot;));
         //register a number prompt, for grabbing integers
         AddDialog(new NumberPrompt&lt;int&gt;(&quot;NumPrompt&quot;));         </code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show" id="step4" role="tabpanel" aria-labelledby="step4-tab">
                        <h1>Step 4</h1>
                        Over to you. Based on what you lea<span class="inline-comment-marker"
                            data-ref="1d3993b7-0f21-4b1b-bb05-471e8a2f3cdb">rned from building th</span>e
                        GreetingDialog:
                        <br>
                        <h2>4a</h2>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            <span class="inline-comment-marker" data-ref="2f4427a9-8fb4-4d29-8bed-2dc7e5022a8d">
                                Send
                                the next prompt
                            </span>, from a step called NameStandStep.
                            This prompt should store the result of preceeding step in the Context’s Values
                            dictionary, you can get this from the stepContext’s results property using a cast to
                            FoundChoice:
                            <code>((FoundChoice)stepContext.Result).Value</code>
                            This is should make use of the TextPrompt. Send the question from the flow diagram above.
                        </div>
                        <br>
                        <h2>4b</h2>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Add a step called ChooseZoneStep
                            It should store the Stand name.
                            Then send the ‘YesNoPrompt’ with text - “Do you know which zone”.
                            Include a retry with ‘please provide a Yes or No answer’.
                        </div>
                        <br>
                        <h2>4c</h2>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Add another step called NameZoneStep.
                            It should first get the result from the prceeding step. Cast to boolean using the ‘bool’
                            keyword. You can then use it in a conditional staetment:
                            if the result is true, send the next text prompt - “Which Zone?”
                            if the result is false, call a method ‘FinishAsync', e..g:
                        </div>
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence">         var result = (bool)stepContext.Result;
         if (result)
         {
            return stepContext.PromptAsync(nameof(TextPrompt), new PromptOptions { Prompt = MessageFactory.Text(&quot;What Zone?&quot;)}, cancellationToken );
         }
         else
         {
            return FinishAsync(stepContext, cancellationToken);
         }</code></pre>
                            </div>
                        </div>
                        <br>
                        <h2>4d</h2>
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            OK, build up the remaining steps to complete the flow, remember to send the ‘YesNoPrompt’
                            first, then either a Text Prompt or a NumPrompt. Make sure you store the text or number
                            values in the stepcontext’s Values dictionary.
                        </div>
                        <div class="alert alert-info" role="alert">
                            <i class="fa fa-info"></i>
                            To get the row - send a Text Prompt.
                            To get the seat - send a NumPrompt -cast the result to an int.
                            For the reporter’s seat, send a NumPrompt - cast the result to an int.
                        </div>
                        <br>
                        <h2>4e</h2>
                        After the final question (to get the Reporter’s seat)..
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Add a step to capture it, and move immediately on to the FinishAsync:
                        </div>
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence">      private async Task&lt;DialogTurnResult&gt; CaptureReporterSeatStep(WaterfallStepContext stepContext, CancellationToken cancellationToken)
      {
         stepContext.Values[&quot;ReporterSeat&quot;] = (int)stepContext.Result;
         return await FinishAsync(stepContext, cancellationToken);
      }</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade show" id="step5" role="tabpanel" aria-labelledby="step5-tab">
                        <h2>Step 5</h2>
                        <span class="inline-comment-marker" data-ref="c20742fd-f829-483e-beb1-1033bb598709">
                            Add the
                            FinishAsync to your waterfall steps to complete the dialog
                        </span>:
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence"> private async Task&lt;DialogTurnResult&gt; FinishAsync(WaterfallStepContext stepContext, CancellationToken cancellationToken)
      {
         return await stepContext.EndDialogAsync(new LocationResult
         {
            Club = (string)stepContext.Values[&quot;Club&quot;],
            Row = stepContext.Values.ContainsKey(&quot;Row&quot;) ? (string)stepContext.Values[&quot;Row&quot;] : null,
            Seat = stepContext.Values.ContainsKey(&quot;Seat&quot;) ? (int)stepContext.Values[&quot;Seat&quot;] : 0,
            Stand = stepContext.Values.ContainsKey(&quot;Stand&quot;) ? (string)stepContext.Values[&quot;Stand&quot;] : null,
            ReporterSeat = stepContext.Values.ContainsKey(&quot;ReporterSeat&quot;) ? (int)stepContext.Values[&quot;ReporterSeat&quot;] : 0,
         },
          cancellationToken);
      }</code></pre>
                            </div>
                        </div>
                        <div class="alert alert-info" role="alert">
                            <i class="fa fa-info"></i>
                            This block uses something known as the ‘ternary’ operator, it is in the convention of:
                            <em>boolean condition ? if true : else, false.</em>
                            It is typically used as above, to do a quick check inline to choose a value.
                            You can read more on it in the Microsoft documentation here: <a
                                href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/conditional-operator"
                                class="external-link"
                                rel="nofollow">https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/conditional-operator</a>
                        </div>
                    </div>
                    <div class="tab-pane fade show" id="step6" role="tabpanel" aria-labelledby="step6-tab">
                        <h1>Step 6</h1>
                        Finally, we’re going to say thank you, and prepare to capture the next dialog.
                        <div class="alert alert-primary" role="alert">
                            <i class="fa fa-tasks"></i>
                            Back in the HCRDialog class, in the OnTurnAsync, extend the method to handle the
                            completion of this dialog as below:
                        </div>
                        <div class="code panel pdl" style="border-width: 1px;">
                            <div class="codeContent panelContent pdl">
                                <pre><code class="csharp"
                                       data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence"
                                       data-theme="Confluence"> if (continueResult.Status == DialogTurnStatus.Complete)
                  {
                     switch (lastdialog)
                     {
                        case nameof(GreetingDialog):
                           var greetingResult = (GreetingResult)continueResult.Result;
                           await turnContext.SendActivityAsync(MessageFactory.Text($&quot;You have reported a crime of {greetingResult.CrimeType}.&quot;), cancellationToken);
                           await turnContext.SendActivityAsync(MessageFactory.Text(ThankYou), cancellationToken);
                           await dc.BeginDialogAsync(nameof(LocationDialog), null, cancellationToken);
                           break;
                        case nameof(LocationDialog):
                           var locationResult = (LocationResult)continueResult.Result;
                           await turnContext.SendActivityAsync(MessageFactory.Text(&quot;Thanks, I now have all the location details stored. Let’s move onto description of the offenders.&quot;), cancellationToken);
                           break;
                     }
                  }</code></pre>
                            </div>
                        </div>
                        <p />
                        <div class="alert alert-success" role="alert">
                            <i class="fa fa-check"></i>
                            Good job, you should now have a working chatbot, with two Dialogs. Give it a test, and
                            commit your changes.
                            You should now have a good grasp of how to build up a bot using dialogs. Make sure you
                            understand what as going on in each step, and when you’re ready, move on to next stage
                            of the tutorial.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <footer class="blockquote-footer">
                <section class="footer-body">
                    Copyright Principle One Ltd 2020
                </section>
            </footer>
        </div>
    </div>
    <script>hljs.initHighlightingOnLoad();</script>
    </div>
</body>

</html>